<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Perfil</title>
  <link rel="stylesheet" href="/styles/perfil.css">
</head>
<body>
<div th:replace="fragments/header :: headerFragment"></div>

<div class="profile-content">
  <main class="profile-container">
    <!-- Sidebar del perfil -->
    <div class="profile-sidebar">
      <img src="/img/user.png" alt="Avatar" class="profile-avatar">
      <h3 class="username" th:classappend="${usuario.premium ? 'premium-user' : ''}" th:text="${usuario.nombre}">Usuario</h3>

      <p class="email" th:text="${usuario.email}">usuario@ejemplo.com</p>
      <p class="fecha-alta" th:text="${#temporals.format(usuario.fechaAlta, 'dd/MM/yyyy')}">Miembro desde: 01/05/2022</p>
      <p class="premium-status" th:classappend="${usuario.premium ? 'premium-user' : ''}" th:text="${usuario.premium ? 'Cuenta Premium' : 'Cuenta Básica'}"></p>

      <button class="btn-premium" th:text="${usuario.premium ? 'Anular suscripción' : 'Hazte Premium'}" disabled></button>
    </div>

    <!-- Contenido principal -->
    <div class="profile-form-section">
      <form class="profile-form" th:action="@{/perfil/actualizar}" method="post">
        <label for="nombre">Nombre</label>
        <input type="text" id="nombre" name="nombre" th:value="${usuario.nombre}" required>

        <label for="fechaNacimiento">Fecha de Nacimiento</label>
        <input type="date" id="fechaNacimiento" name="fechaNacimiento" th:value="${usuario.fechaNacimiento}" required>

        <div class="form-actions">
          <button type="submit">Guardar cambios</button>
          <button type="button" class="btn-conectar">Conecta con otras plataformas</button>
        </div>
      </form>

      <div th:if="${mensaje}" class="alert alert-success">
        <p th:text="${mensaje}"></p>
      </div>
      <div th:if="${error}" class="alert alert-danger">
        <p th:text="${error}"></p>
      </div>

      <div class="recent-reviews">
        <h4>Últimas reviews</h4>
        <div id="reviews-container">
          <div th:each="review : ${ultimasReviews}" class="review">
            <img th:src="@{'http://localhost:8080/img/games/' + ${review.juegoId} + '.png'}"
                 alt="Imagen del juego" class="game-image"/>

            <div class="review-content">
              <div class="review-header">
                <strong th:text="${review.tituloJuego}">Nombre del Juego</strong>

                <div class="review-rating">
                  <span class="star" data-index="1"></span>
                  <span class="star" data-index="2"></span>
                  <span class="star" data-index="3"></span>
                  <span class="star" data-index="4"></span>
                  <span class="star" data-index="5"></span>
                </div>

                <span class="review-score" th:text="${review.nota}"></span>
              </div>
              <p th:text="${review.reseña}"></p>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>
</div> 

<footer class="main-footer"></footer>

<script>
  document.querySelectorAll('.review').forEach(review => {
    const rating = parseFloat(review.querySelector('.review-score').innerText);
    const stars = review.querySelectorAll('.star');

    stars.forEach((star, index) => {
      const position = (index + 1) * 2;
      star.classList.remove('full', 'half');

      if (rating >= position) {
        star.classList.add('full');
      } else if (rating >= position - 1) {
        star.classList.add('half');
      }
    });
  });
</script>

<script src="/js/perfil.js" type="module"></script>
</body>
</html>
